{"metadata":{"roleHeading":"Article","role":"article","modules":[{"name":"PushwooshVoIP"}],"title":"Code Examples"},"seeAlsoSections":[{"generated":true,"title":"Getting Started","identifiers":["doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP\/GettingStarted"]}],"variants":[{"paths":["\/documentation\/pushwooshvoip\/examples"],"traits":[{"interfaceLanguage":"swift"}]},{"paths":["\/documentation\/pushwooshvoip\/examples"],"traits":[{"interfaceLanguage":"occ"}]}],"kind":"article","hierarchy":{"paths":[["doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP"]]},"schemaVersion":{"patch":0,"minor":3,"major":0},"sections":[],"abstract":[{"text":"Practical examples for common VoIP integration scenarios.","type":"text"}],"primaryContentSections":[{"content":[{"type":"heading","anchor":"Overview","level":2,"text":"Overview"},{"inlineContent":[{"type":"text","text":"This guide provides working code examples for typical use cases with PushwooshVoIP module."}],"type":"paragraph"},{"type":"heading","text":"Basic Setup","anchor":"Basic-Setup","level":2},{"level":3,"type":"heading","anchor":"Minimal-Configuration","text":"Minimal Configuration"},{"code":["import UIKit","import PushwooshFramework","import PushwooshVoIP","import CallKit","import PushKit","","@main","class AppDelegate: UIResponder, UIApplicationDelegate, PWVoIPCallDelegate {","","    func application(","        _ application: UIApplication,","        didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?","    ) -> Bool {","","        Pushwoosh.VoIP.initializeVoIP(false, ringtoneSound: nil, handleTypes: 2)","        Pushwoosh.VoIP.setPushwooshVoIPAppId(\"YOUR-VOIP-APP-CODE\")","        Pushwoosh.VoIP.delegate = self","","        return true","    }","","    func voipDidReceiveIncomingCall(payload: PushwooshVoIP.PWVoIPMessage) {","        print(\"Incoming call: \\(payload.callerName ?? \"Unknown\")\")","    }","","    func pwProviderDidReset(_ provider: CXProvider) {","        print(\"Provider reset\")","    }","","    func pwProviderDidBegin(_ provider: CXProvider) {","        print(\"Provider ready\")","    }","}"],"syntax":"swift","type":"codeListing"},{"text":"Handling Incoming Calls","anchor":"Handling-Incoming-Calls","type":"heading","level":2},{"text":"Store Call Information","level":3,"anchor":"Store-Call-Information","type":"heading"},{"type":"codeListing","syntax":"swift","code":["class CallManager {","    static let shared = CallManager()","","    private var activeCalls: [UUID: CallInfo] = [:]","","    struct CallInfo {","        let uuid: UUID","        let callerName: String","        let hasVideo: Bool","        let timestamp: Date","    }","","    func storeCall(_ payload: PWVoIPMessage) {","        guard let uuidString = payload.uuid,","              let uuid = UUID(uuidString: uuidString) else {","            return","        }","","        let callInfo = CallInfo(","            uuid: uuid,","            callerName: payload.callerName ?? \"Unknown\",","            hasVideo: payload.hasVideo,","            timestamp: Date()","        )","","        activeCalls[uuid] = callInfo","    }","","    func getCall(uuid: UUID) -> CallInfo? {","        return activeCalls[uuid]","    }","","    func removeCall(uuid: UUID) {","        activeCalls.removeValue(forKey: uuid)","    }","}","","extension AppDelegate: PWVoIPCallDelegate {","","    func voipDidReceiveIncomingCall(payload: PushwooshVoIP.PWVoIPMessage) {","        CallManager.shared.storeCall(payload)","    }","}"]},{"level":3,"type":"heading","text":"Answer Call","anchor":"Answer-Call"},{"type":"codeListing","syntax":"swift","code":["extension AppDelegate: PWVoIPCallDelegate {","","    func pwPerform(_ action: CXAnswerCallAction) {","        let callUUID = action.callUUID","","        guard let callInfo = CallManager.shared.getCall(uuid: callUUID) else {","            action.fail()","            return","        }","","        let audioSession = AVAudioSession.sharedInstance()","        do {","            try audioSession.setCategory(.playAndRecord, mode: .voiceChat)","            try audioSession.setActive(true)","        } catch {","            action.fail()","            return","        }","","        startCallWithPeer(callInfo.callerName)","        action.fulfill()","    }","","    private func startCallWithPeer(_ peerName: String) {","        print(\"Starting call with \\(peerName)\")","    }","}"]},{"text":"End Call","level":3,"type":"heading","anchor":"End-Call"},{"code":["extension AppDelegate: PWVoIPCallDelegate {","","    func pwPerform(_ action: CXEndCallAction) {","        let callUUID = action.callUUID","","        endCallSession(callUUID)","        CallManager.shared.removeCall(uuid: callUUID)","","        let audioSession = AVAudioSession.sharedInstance()","        try? audioSession.setActive(false, options: .notifyOthersOnDeactivation)","","        action.fulfill()","    }","","    private func endCallSession(_ uuid: UUID) {","        print(\"Ending call: \\(uuid)\")","    }","}"],"syntax":"swift","type":"codeListing"},{"type":"heading","text":"Call Controls","level":2,"anchor":"Call-Controls"},{"type":"heading","text":"Mute\/Unmute","anchor":"MuteUnmute","level":3},{"type":"codeListing","syntax":"swift","code":["extension AppDelegate: PWVoIPCallDelegate {","","    func pwPerform(_ action: CXSetMutedCallAction) {","        let isMuted = action.isMuted","","        if isMuted {","            disableMicrophone()","        } else {","            enableMicrophone()","        }","","        action.fulfill()","    }","","    private func disableMicrophone() {","        print(\"Microphone disabled\")","    }","","    private func enableMicrophone() {","        print(\"Microphone enabled\")","    }","}"]},{"anchor":"HoldResume","level":3,"text":"Hold\/Resume","type":"heading"},{"syntax":"swift","code":["extension AppDelegate: PWVoIPCallDelegate {","","    func pwPerform(_ action: CXSetHeldCallAction) {","        let callUUID = action.callUUID","        let isOnHold = action.isOnHold","","        if isOnHold {","            pauseCall(callUUID)","        } else {","            resumeCall(callUUID)","        }","","        action.fulfill()","    }","","    private func pauseCall(_ uuid: UUID) {","        print(\"Call paused: \\(uuid)\")","    }","","    private func resumeCall(_ uuid: UUID) {","        print(\"Call resumed: \\(uuid)\")","    }","}"],"type":"codeListing"},{"anchor":"Token-Management","level":2,"text":"Token Management","type":"heading"},{"text":"Monitor Token Registration","level":3,"type":"heading","anchor":"Monitor-Token-Registration"},{"syntax":"swift","code":["extension AppDelegate: PWVoIPCallDelegate {","","    func voipDidRegisterVoIPToken(token: String) {","        print(\"VoIP token registered: \\(token)\")","","        UserDefaults.standard.set(token, forKey: \"voip_token\")","        UserDefaults.standard.set(Date(), forKey: \"voip_token_date\")","","        sendTokenToBackend(token)","    }","","    func voipDidFailRegisterVoIPToken(error: String) {","        print(\"Token registration failed: \\(error)\")","","        DispatchQueue.main.asyncAfter(deadline: .now() + 10.0) {","            self.retryTokenRegistration()","        }","    }","","    private func sendTokenToBackend(_ token: String) {","        print(\"Sending token to backend\")","    }","","    private func retryTokenRegistration() {","        Pushwoosh.VoIP.setPushwooshVoIPAppId(\"YOUR-VOIP-APP-CODE\")","    }","}"],"type":"codeListing"},{"anchor":"Video-Calls","type":"heading","level":2,"text":"Video Calls"},{"anchor":"Enable-Video-Support","text":"Enable Video Support","level":3,"type":"heading"},{"code":["func application(","    _ application: UIApplication,","    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?",") -> Bool {","","    Pushwoosh.VoIP.initializeVoIP(true, ringtoneSound: nil, handleTypes: 2)","    Pushwoosh.VoIP.setPushwooshVoIPAppId(\"YOUR-VOIP-APP-CODE\")","    Pushwoosh.VoIP.delegate = self","","    return true","}","","extension AppDelegate: PWVoIPCallDelegate {","","    func voipDidReceiveIncomingCall(payload: PushwooshVoIP.PWVoIPMessage) {","        if payload.hasVideo {","            print(\"Incoming VIDEO call\")","            prepareVideoCallUI()","        } else {","            print(\"Incoming AUDIO call\")","            prepareAudioCallUI()","        }","","        CallManager.shared.storeCall(payload)","    }","","    private func prepareVideoCallUI() {","        print(\"Preparing video call UI\")","    }","","    private func prepareAudioCallUI() {","        print(\"Preparing audio call UI\")","    }","}"],"syntax":"swift","type":"codeListing"},{"anchor":"Handle-Types","type":"heading","text":"Handle Types","level":2},{"text":"Phone Number Format","level":3,"type":"heading","anchor":"Phone-Number-Format"},{"type":"codeListing","syntax":"swift","code":["Pushwoosh.VoIP.initializeVoIP(true, ringtoneSound: nil, handleTypes: 2)"]},{"anchor":"Email-Format","type":"heading","level":3,"text":"Email Format"},{"type":"codeListing","syntax":"swift","code":["Pushwoosh.VoIP.initializeVoIP(true, ringtoneSound: nil, handleTypes: 3)"]},{"type":"heading","anchor":"Generic-Format","text":"Generic Format","level":3},{"code":["Pushwoosh.VoIP.initializeVoIP(true, ringtoneSound: nil, handleTypes: 1)"],"type":"codeListing","syntax":"swift"},{"level":2,"type":"heading","anchor":"Error-Handling","text":"Error Handling"},{"type":"heading","text":"Handle Provider Reset","anchor":"Handle-Provider-Reset","level":3},{"syntax":"swift","code":["extension AppDelegate: PWVoIPCallDelegate {","","    func pwProviderDidReset(_ provider: CXProvider) {","        print(\"CallKit provider reset\")","","        let allCallUUIDs = CallManager.shared.getAllCallUUIDs()","        for uuid in allCallUUIDs {","            endCallSession(uuid)","            CallManager.shared.removeCall(uuid: uuid)","        }","","        let audioSession = AVAudioSession.sharedInstance()","        try? audioSession.setActive(false)","","        print(\"All calls terminated\")","    }","}"],"type":"codeListing"},{"type":"heading","level":2,"text":"Next Steps","anchor":"Next-Steps"},{"items":[{"content":[{"inlineContent":[{"type":"reference","identifier":"doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP\/GettingStarted","isActive":true},{"type":"text","text":" - Quick start guide"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"isActive":true,"identifier":"doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP\/PWVoIPCallDelegate","type":"reference"},{"type":"text","text":" - Full delegate reference"}]}]}],"type":"unorderedList"}],"kind":"content"}],"identifier":{"url":"doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP\/Examples","interfaceLanguage":"swift"},"references":{"doc://com.pushwoosh.PushwooshVoIP/documentation/PushwooshVoIP":{"type":"topic","url":"\/documentation\/pushwooshvoip","abstract":[{"type":"text","text":"VoIP push notifications with native call UI for iOS applications."}],"identifier":"doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP","role":"collection","title":"PushwooshVoIP","kind":"symbol"},"doc://com.pushwoosh.PushwooshVoIP/documentation/PushwooshVoIP/GettingStarted":{"role":"article","title":"Getting Started","kind":"article","url":"\/documentation\/pushwooshvoip\/gettingstarted","type":"topic","abstract":[{"type":"text","text":"Set up VoIP push notifications with CallKit in your iOS app."}],"identifier":"doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP\/GettingStarted"},"doc://com.pushwoosh.PushwooshVoIP/documentation/PushwooshVoIP/PWVoIPCallDelegate":{"fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"PWVoIPCallDelegate","kind":"identifier"}],"type":"topic","url":"\/documentation\/pushwooshvoip\/pwvoipcalldelegate","navigatorTitle":[{"text":"PWVoIPCallDelegate","kind":"identifier"}],"abstract":[{"type":"text","text":"Delegate protocol for receiving VoIP call events and CallKit callbacks."}],"identifier":"doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP\/PWVoIPCallDelegate","role":"symbol","title":"PWVoIPCallDelegate","kind":"symbol"}},"variantOverrides":[{"patch":[{"value":"occ","path":"\/identifier\/interfaceLanguage","op":"replace"},{"path":"\/topicSections","op":"add","value":null},{"op":"replace","path":"\/seeAlsoSections","value":[{"generated":true,"title":"Getting Started","identifiers":["doc:\/\/com.pushwoosh.PushwooshVoIP\/documentation\/PushwooshVoIP\/GettingStarted"]}]},{"value":"PWVoIPCallDelegate","path":"\/references\/doc:~1~1com.pushwoosh.PushwooshVoIP~1documentation~1PushwooshVoIP~1PWVoIPCallDelegate\/title","op":"replace"},{"value":[{"kind":"identifier","text":"PWVoIPCallDelegate"}],"op":"replace","path":"\/references\/doc:~1~1com.pushwoosh.PushwooshVoIP~1documentation~1PushwooshVoIP~1PWVoIPCallDelegate\/fragments"}],"traits":[{"interfaceLanguage":"occ"}]}]}