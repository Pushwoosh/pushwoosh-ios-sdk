{"abstract":[{"type":"text","text":"Sets the delegate for in-app purchase events from rich media."}],"variants":[{"traits":[{"interfaceLanguage":"occ"}],"paths":["\/documentation\/pushwooshcore\/pwconfiguration\/setpurchasedelegate:"]}],"schemaVersion":{"major":0,"patch":0,"minor":3},"metadata":{"roleHeading":"Type Method","modules":[{"name":"PushwooshCore"}],"fragments":[{"kind":"text","text":"+ "},{"text":"setPurchaseDelegate:","kind":"identifier"}],"navigatorTitle":[{"kind":"identifier","text":"setPurchaseDelegate:"}],"symbolKind":"method","externalID":"c:objc(pl)PWConfiguration(cm)setPurchaseDelegate:","role":"symbol","title":"setPurchaseDelegate:"},"sections":[],"hierarchy":{"paths":[["doc:\/\/com.pushwoosh.PushwooshCore\/documentation\/PushwooshCore","doc:\/\/com.pushwoosh.PushwooshCore\/documentation\/PushwooshCore\/PWConfiguration"]]},"kind":"symbol","primaryContentSections":[{"kind":"declarations","declarations":[{"languages":["occ"],"platforms":["iOS"],"tokens":[{"kind":"text","text":"+ ("},{"text":"void","preciseIdentifier":"c:v","kind":"typeIdentifier"},{"kind":"text","text":") "},{"kind":"identifier","text":"setPurchaseDelegate:"},{"kind":"text","text":"("},{"preciseIdentifier":"c:Qoobjc(pl)PWPurchaseDelegate","text":"id<PWPurchaseDelegate>","kind":"typeIdentifier"},{"text":") ","kind":"text"},{"kind":"internalParam","text":"delegate"},{"text":";","kind":"text"}]}]},{"parameters":[{"content":[{"inlineContent":[{"type":"text","text":"Object implementing PWPurchaseDelegate protocol, or nil to remove the delegate"}],"type":"paragraph"}],"name":"delegate"}],"kind":"parameters"},{"content":[{"text":"Discussion","anchor":"discussion","level":2,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"The delegate will receive callbacks for in-app purchase events triggered from","type":"text"},{"type":"text","text":" "},{"text":"Pushwoosh rich media content (HTML pages, in-app messages).","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This enables:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Handling promoted purchases from the App Store","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Processing purchases initiated from rich media"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Tracking purchase completions and failures"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Restoring previous purchases"}]}]}]},{"level":2,"type":"heading","text":"Example","anchor":"Example"},{"inlineContent":[{"type":"text","text":"Handle in-app purchases from rich media:"}],"type":"paragraph"},{"code":["class PurchaseCoordinator: NSObject, PWPurchaseDelegate {","","    static let shared = PurchaseCoordinator()","","    func setup() {","        Pushwoosh.configure.setPurchaseDelegate(self)","    }","","    \/\/ MARK: - PWPurchaseDelegate","","    func onPW(inAppPurchaseHelperCallPromotedPurchase identifier: String) {","        Logger.info(\"Promoted purchase initiated: \\(identifier)\")","","        \/\/ Verify user is ready to purchase","        guard UserSession.shared.isLoggedIn else {","            \/\/ Save for later and prompt login","            PendingPurchaseManager.shared.save(identifier)","            NavigationCoordinator.shared.showLogin(reason: .purchase)","            return","        }","","        \/\/ Process the purchase","        IAPManager.shared.purchase(productIdentifier: identifier)","    }","","    func onPWInAppPurchaseHelperPaymentComplete(_ identifier: String) {","        Logger.info(\"Purchase completed: \\(identifier)\")","","        \/\/ Update user status","        Pushwoosh.configure.setTags([","            \"last_purchase\": identifier,","            \"last_purchase_date\": Date(),","            \"has_purchased\": true","        ])","","        \/\/ Unlock content","        ContentUnlocker.shared.unlock(identifier)","","        \/\/ Track in analytics","        Analytics.track(\"purchase_completed\", properties: [","            \"product_id\": identifier,","            \"source\": \"rich_media\"","        ])","    }","","    func onPWInAppPurchaseHelperPaymentFailedProductIdentifier(_ identifier: String, error: Error) {","        Logger.error(\"Purchase failed: \\(identifier) - \\(error.localizedDescription)\")","","        Analytics.track(\"purchase_failed\", properties: [","            \"product_id\": identifier,","            \"error\": error.localizedDescription","        ])","    }","}"],"syntax":"swift","type":"codeListing"}],"kind":"content"}],"identifier":{"url":"doc:\/\/com.pushwoosh.PushwooshCore\/documentation\/PushwooshCore\/PWConfiguration\/setPurchaseDelegate:","interfaceLanguage":"occ"},"references":{"doc://com.pushwoosh.PushwooshCore/documentation/PushwooshCore/PWConfiguration/setPurchaseDelegate:":{"navigatorTitle":[{"text":"setPurchaseDelegate:","kind":"identifier"}],"type":"topic","url":"\/documentation\/pushwooshcore\/pwconfiguration\/setpurchasedelegate:","identifier":"doc:\/\/com.pushwoosh.PushwooshCore\/documentation\/PushwooshCore\/PWConfiguration\/setPurchaseDelegate:","abstract":[{"text":"Sets the delegate for in-app purchase events from rich media.","type":"text"}],"role":"symbol","title":"setPurchaseDelegate:","kind":"symbol","fragments":[{"text":"+ ","kind":"text"},{"text":"setPurchaseDelegate:","kind":"identifier"}]},"doc://com.pushwoosh.PushwooshCore/documentation/PushwooshCore":{"title":"PushwooshCore","url":"\/documentation\/pushwooshcore","kind":"symbol","role":"collection","type":"topic","identifier":"doc:\/\/com.pushwoosh.PushwooshCore\/documentation\/PushwooshCore","abstract":[{"type":"text","text":"Core foundation module for Pushwoosh SDK."}]},"doc://com.pushwoosh.PushwooshCore/documentation/PushwooshCore/PWConfiguration":{"url":"\/documentation\/pushwooshcore\/pwconfiguration","title":"PWConfiguration","abstract":[],"fragments":[{"text":"PWConfiguration","kind":"identifier"}],"kind":"symbol","type":"topic","identifier":"doc:\/\/com.pushwoosh.PushwooshCore\/documentation\/PushwooshCore\/PWConfiguration","role":"symbol"}}}